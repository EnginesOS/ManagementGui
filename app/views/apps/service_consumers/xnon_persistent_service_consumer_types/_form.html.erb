<%= custom_form_for @non_persistent_service_consumer,
      url: app_service_consumer_non_persistent_path(app_id: @app.id) do |f| %>
      <%= f.hidden_field :service_container_name %>
      <%= f.hidden_field :parent_engine %>
      <%= f.hidden_field :label %>
      <%= f.hidden_field :service_handle %>
      <%= f.hidden_field :existing_service_consumer %>
  <%= f.fields_for :fields do |ff| %>
    <%= ff.engines_field_builder %>
  <% end %>
  <% cancel_url = @non_persistent_service_consumer.persisted? ?
      app_service_consumer_non_persistent_path(
        app_id: @app.id,
        service_container_name: @non_persistent_service_consumer.
                                            service_container_name,
        parent_engine: @non_persistent_service_consumer.parent_engine ) :
      new_app_service_consumer_path( app_id: @app.id ) %>
  <%= f.engines_cancel_submit url: cancel_url, remote: true %>
<% end %>
